<style>
.print-format {
	font-size: 9pt !important;
}
.right-border {
    border-right: 1px #808588 solid !important;
}
.print-format td, .print-format th {
    padding: 5px !important;
	vertical-align:middle !important;
}
</style>

<h2 class="text-center" style="margin-top:0">Price List</h2>
<h4 class="text-center">
	{% if (filters.customer_name) { %}
		{%= filters.customer_name %}
	{% } else if(filters.customer) { %}
		{%= filters.customer %}
	{% } %}
</h4>
<h5 class="text-center">
	{%= __("From") %}
	{%= frappe.datetime.str_to_user(filters.date) %}
</h5>

{%

var item_groups = {};

for(var i = 0; i < data.length; i++) {
    if (!data[i].item_code) {
        continue;
    }

    if (!item_groups.hasOwnProperty(data[i].item_group)) {
        item_groups[data[i].item_group] = [];
    }

    var group = item_groups[data[i].item_group];
    group.push(data[i]);
}

$.each(item_groups || {}, function(item_group, items) {
    item_groups[item_group] = items.sort((a, b) => a.item_name.localeCompare(b.item_name));
});

//var ordered = {};
//Object.keys(item_groups).sort().forEach(function(key) {
//  ordered[key] = item_groups[key];
//});
item_groups = ordered;

%}

<table class="table table-bordered">
	<thead>
		<tr>
            <th style="width: 38%">{%= __("Product") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Per Box") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Origin") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Price") %}</th>
            <th style="width: 3%" class="right-border text-right">{%= __("Order") %}</th>

            <th style="width: 38%">{%= __("Product") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Per Box") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Origin") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Price") %}</th>
            <th style="width: 3%" class="right-border text-right">{%= __("Order") %}</th>

            <th style="width: 38%">{%= __("Product") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Per Box") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Origin") %}</th>
            <th style="width: 3%" class="text-center">{%= __("Price") %}</th>
            <th style="width: 3%" class="text-right">{%= __("Order") %}</th>
		</tr>
	</thead>
	<tbody>
    {% $.each(item_groups || {}, function(item_group, items) { %}
        <tr>
            <td colspan="15" class="text-center" style="font-size: 12pt"><strong>{%= item_group %}</strong></td>
        </tr>

        {% $.each(items || [], function(i, d) { %}
            {% if (i % 3 == 0) { %}
            <tr>
            {% } %}
                <td>{%= d.item_name %}</td>
                <td class="text-center">{%= d.weight %}</td>
                <td class="text-center">{%= d.origin %}</td>
                <td class="text-center">{%= d.print_rate ? format_currency(d.print_rate) : '' %}</td>
                <td class="text-right{% if (i % 3 != 2) { %} right-border{% } %}"></td>
                {% if (i % 3 == 0 && i == items.length - 1) { %}
                    <td></td><td></td><td></td><td></td><td class="right-border"></td><td></td><td></td><td></td><td></td><td></td>
                {% } %}
                {% if (i % 3 == 1 && i == items.length - 1) { %}
                    <td></td><td></td><td></td><td></td><td></td>
                {% } %}
            {% if (i % 3 == 2 || i == items.length - 1) { %}
            </tr>
            {% } %}
        {% }); %}
    {% }); %}
	</tbody>
</table>
<p class="text-right text-muted">{{ __("Printed On ") }}{%= frappe.datetime.str_to_user(frappe.datetime.get_datetime_as_string()) %}</p>
